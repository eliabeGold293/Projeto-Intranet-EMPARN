###############################################
# CONFIGURAÇÃO PRINCIPAL
###############################################
RewriteEngine On

# Ajusta automaticamente caso o projeto esteja em uma subpasta
RewriteBase /

###############################################
# EXCEÇÕES (NÃO PASSAM PELO ROTEADOR)
###############################################

# LOGIN (aceita /login e /login.php)
RewriteCond %{REQUEST_URI} ^/login$ [NC,OR]
RewriteCond %{REQUEST_URI} ^/login\.php$ [NC]
RewriteRule ^ - [L]

# APIs (qualquer arquivo dentro de /apis/)
RewriteCond %{REQUEST_URI} ^/apis/ [NC]
RewriteRule ^ - [L]

# Arquivos existentes físicos
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Diretórios físicos existentes
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]


###############################################
# ROTEAMENTO PRINCIPAL
###############################################
# Tudo que não cair nas regras acima vai para index.php
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]


###############################################
# SEGURANÇA
###############################################

# Bloquear acesso direto a arquivos sensíveis
<FilesMatch "(connection|config|env|settings)\.php$">
    Require all denied
</FilesMatch>

# Bloquear acesso a diretórios internos críticos
RedirectMatch 403 ^/(core|private|storage|includes|templates)/.*$


###############################################
# CACHE - OPCIONAL
###############################################
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 7 days"
    ExpiresByType application/javascript "access plus 7 days"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
</IfModule>
